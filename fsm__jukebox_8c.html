<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Jukebox Project: common/src/fsm_jukebox.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Jukebox Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('fsm__jukebox_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">fsm_jukebox.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Jukebox FSM main file.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;fsm.h&gt;</code><br />
<code>#include &quot;<a class="el" href="fsm__jukebox_8h.html">fsm_jukebox.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fsm__button_8h.html">fsm_button.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fsm__usart_8h.html">fsm_usart.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="fsm__buzzer_8h.html">fsm_buzzer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="port__system_8h.html">port_system.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="port__usart_8h.html">port_usart.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:afa99ec4acc4ecb2dc3c2d05da15d0e3f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(a,  b)&#160;&#160;&#160;((a) &gt; (b) ? (a) : (b))</td></tr>
<tr class="separator:afa99ec4acc4ecb2dc3c2d05da15d0e3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa467014fd4156f5f687426203b75bc45"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#aa467014fd4156f5f687426203b75bc45">_parse_message</a> (char *p_message, char *p_command, char *p_param)</td></tr>
<tr class="memdesc:aa467014fd4156f5f687426203b75bc45"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse the message received by the USART.  <a href="fsm__jukebox_8c.html#aa467014fd4156f5f687426203b75bc45">More...</a><br /></td></tr>
<tr class="separator:aa467014fd4156f5f687426203b75bc45"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4ee155c8c44743e7b13f452e6647cd9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#ac4ee155c8c44743e7b13f452e6647cd9">_set_next_song</a> (<a class="el" href="structfsm__jukebox__t.html">fsm_jukebox_t</a> *p_fsm_jukebox)</td></tr>
<tr class="memdesc:ac4ee155c8c44743e7b13f452e6647cd9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the next song to be played.  <a href="fsm__jukebox_8c.html#ac4ee155c8c44743e7b13f452e6647cd9">More...</a><br /></td></tr>
<tr class="separator:ac4ee155c8c44743e7b13f452e6647cd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01e7f7a7784027fc9217fd0d0f4f2423"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a01e7f7a7784027fc9217fd0d0f4f2423">_execute_command</a> (<a class="el" href="structfsm__jukebox__t.html">fsm_jukebox_t</a> *p_fsm_jukebox, char *p_command, char *p_param)</td></tr>
<tr class="memdesc:a01e7f7a7784027fc9217fd0d0f4f2423"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute the command received by the USART.  <a href="fsm__jukebox_8c.html#a01e7f7a7784027fc9217fd0d0f4f2423">More...</a><br /></td></tr>
<tr class="separator:a01e7f7a7784027fc9217fd0d0f4f2423"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab64512dbce31c38a36bff5e337f4fb8f"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#ab64512dbce31c38a36bff5e337f4fb8f">check_on</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:ab64512dbce31c38a36bff5e337f4fb8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the button has been pressed for the required time to turn ON the Jukebox.  <a href="fsm__jukebox_8c.html#ab64512dbce31c38a36bff5e337f4fb8f">More...</a><br /></td></tr>
<tr class="separator:ab64512dbce31c38a36bff5e337f4fb8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a941bb12de41897bba2b612cc87b3164b"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a941bb12de41897bba2b612cc87b3164b">check_off</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:a941bb12de41897bba2b612cc87b3164b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the button has been pressed for the required time to turn OFF the Jukebox.  <a href="fsm__jukebox_8c.html#a941bb12de41897bba2b612cc87b3164b">More...</a><br /></td></tr>
<tr class="separator:a941bb12de41897bba2b612cc87b3164b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab86b278e34221a6d9698ecda96db6806"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#ab86b278e34221a6d9698ecda96db6806">check_melody_finished</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:ab86b278e34221a6d9698ecda96db6806"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the buzzer has finished playing the melody.  <a href="fsm__jukebox_8c.html#ab86b278e34221a6d9698ecda96db6806">More...</a><br /></td></tr>
<tr class="separator:ab86b278e34221a6d9698ecda96db6806"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac620719196f7742a5e56bf2b96ca822e"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#ac620719196f7742a5e56bf2b96ca822e">check_next_song_button</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:ac620719196f7742a5e56bf2b96ca822e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the button has been pressed for the required time to load the next song.  <a href="fsm__jukebox_8c.html#ac620719196f7742a5e56bf2b96ca822e">More...</a><br /></td></tr>
<tr class="separator:ac620719196f7742a5e56bf2b96ca822e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05792c9a5a596679bd73a36882f307eb"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a05792c9a5a596679bd73a36882f307eb">check_command_received</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:a05792c9a5a596679bd73a36882f307eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the USART has received data.  <a href="fsm__jukebox_8c.html#a05792c9a5a596679bd73a36882f307eb">More...</a><br /></td></tr>
<tr class="separator:a05792c9a5a596679bd73a36882f307eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91c31f180f16c2d66ef56e62004c83bc"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a91c31f180f16c2d66ef56e62004c83bc">check_activity</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:a91c31f180f16c2d66ef56e62004c83bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if any of the elements of the system is active.  <a href="fsm__jukebox_8c.html#a91c31f180f16c2d66ef56e62004c83bc">More...</a><br /></td></tr>
<tr class="separator:a91c31f180f16c2d66ef56e62004c83bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05439bd432881a570511d46a7d2ff699"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a05439bd432881a570511d46a7d2ff699">check_no_activity</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:a05439bd432881a570511d46a7d2ff699"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if all the is system active.  <a href="fsm__jukebox_8c.html#a05439bd432881a570511d46a7d2ff699">More...</a><br /></td></tr>
<tr class="separator:a05439bd432881a570511d46a7d2ff699"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a0cabb2cea4aae7bf4da712caa5e539"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a2a0cabb2cea4aae7bf4da712caa5e539">do_start_up</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:a2a0cabb2cea4aae7bf4da712caa5e539"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the Jukebox by playing the intro melody, at the beginning of the program.  <a href="fsm__jukebox_8c.html#a2a0cabb2cea4aae7bf4da712caa5e539">More...</a><br /></td></tr>
<tr class="separator:a2a0cabb2cea4aae7bf4da712caa5e539"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba4043bc9382847ccce22462c81afab6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#aba4043bc9382847ccce22462c81afab6">do_start_jukebox</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:aba4043bc9382847ccce22462c81afab6"><td class="mdescLeft">&#160;</td><td class="mdescRight">After playing the intro melody, start the Jukebox.  <a href="fsm__jukebox_8c.html#aba4043bc9382847ccce22462c81afab6">More...</a><br /></td></tr>
<tr class="separator:aba4043bc9382847ccce22462c81afab6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a6d305c45c351fca9a50a2b5d13d9a6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a7a6d305c45c351fca9a50a2b5d13d9a6">do_stop_jukebox</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:a7a6d305c45c351fca9a50a2b5d13d9a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turn the Jukebox OFF.  <a href="fsm__jukebox_8c.html#a7a6d305c45c351fca9a50a2b5d13d9a6">More...</a><br /></td></tr>
<tr class="separator:a7a6d305c45c351fca9a50a2b5d13d9a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c3617add85a9641d3109be58b5d7632"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a5c3617add85a9641d3109be58b5d7632">do_load_next_song</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:a5c3617add85a9641d3109be58b5d7632"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load the next song.  <a href="fsm__jukebox_8c.html#a5c3617add85a9641d3109be58b5d7632">More...</a><br /></td></tr>
<tr class="separator:a5c3617add85a9641d3109be58b5d7632"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f8454ef1a723bf60fafd717751223c5"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a9f8454ef1a723bf60fafd717751223c5">do_read_command</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:a9f8454ef1a723bf60fafd717751223c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the command received by the USART.  <a href="fsm__jukebox_8c.html#a9f8454ef1a723bf60fafd717751223c5">More...</a><br /></td></tr>
<tr class="separator:a9f8454ef1a723bf60fafd717751223c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a4825398f34ad61ae90c794df3fdaae"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a6a4825398f34ad61ae90c794df3fdaae">do_sleep_while_off</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:a6a4825398f34ad61ae90c794df3fdaae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the low power mode while the Jukebox is OFF.  <a href="fsm__jukebox_8c.html#a6a4825398f34ad61ae90c794df3fdaae">More...</a><br /></td></tr>
<tr class="separator:a6a4825398f34ad61ae90c794df3fdaae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad10008c814d0625ee12467bc836d702"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#aad10008c814d0625ee12467bc836d702">do_sleep_while_on</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:aad10008c814d0625ee12467bc836d702"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the low power mode while the Jukebox is ON.  <a href="fsm__jukebox_8c.html#aad10008c814d0625ee12467bc836d702">More...</a><br /></td></tr>
<tr class="separator:aad10008c814d0625ee12467bc836d702"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70db2ffa8011371d02e1605a9976f6ac"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a70db2ffa8011371d02e1605a9976f6ac">do_sleep_wait_command</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:a70db2ffa8011371d02e1605a9976f6ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the low power mode while the Jukebox is waiting for a command.  <a href="fsm__jukebox_8c.html#a70db2ffa8011371d02e1605a9976f6ac">More...</a><br /></td></tr>
<tr class="separator:a70db2ffa8011371d02e1605a9976f6ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d2922e21185739c528166e38ed8ab3b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a9d2922e21185739c528166e38ed8ab3b">do_sleep_off</a> (fsm_t *p_this)</td></tr>
<tr class="memdesc:a9d2922e21185739c528166e38ed8ab3b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the low power mode while the Jukebox is OFF.  <a href="fsm__jukebox_8c.html#a9d2922e21185739c528166e38ed8ab3b">More...</a><br /></td></tr>
<tr class="separator:a9d2922e21185739c528166e38ed8ab3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad983bf840c4087a815d989b1b927453b"><td class="memItemLeft" align="right" valign="top">fsm_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#ad983bf840c4087a815d989b1b927453b">fsm_jukebox_new</a> (fsm_t *p_fsm_button, uint32_t on_off_press_time_ms, fsm_t *p_fsm_usart, fsm_t *p_fsm_buzzer, uint32_t next_song_press_time_ms)</td></tr>
<tr class="memdesc:ad983bf840c4087a815d989b1b927453b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new jukebox FSM.  <a href="fsm__jukebox_8c.html#ad983bf840c4087a815d989b1b927453b">More...</a><br /></td></tr>
<tr class="separator:ad983bf840c4087a815d989b1b927453b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25d3f74400891769b83494e0202d5607"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#a25d3f74400891769b83494e0202d5607">fsm_jukebox_init</a> (fsm_t *p_this, fsm_t *p_fsm_button, uint32_t on_off_press_time_ms, fsm_t *p_fsm_usart, fsm_t *p_fsm_buzzer, uint32_t next_song_press_time_ms)</td></tr>
<tr class="memdesc:a25d3f74400891769b83494e0202d5607"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a jukebox FSM.  <a href="fsm__jukebox_8c.html#a25d3f74400891769b83494e0202d5607">More...</a><br /></td></tr>
<tr class="separator:a25d3f74400891769b83494e0202d5607"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:acb895e5f6705d5a1b4449f78245f130f"><td class="memItemLeft" align="right" valign="top">fsm_trans_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fsm__jukebox_8c.html#acb895e5f6705d5a1b4449f78245f130f">fsm_trans_jukebox</a> []</td></tr>
<tr class="memdesc:acb895e5f6705d5a1b4449f78245f130f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array representing the transitions table of the FSM Jukebox.  <a href="fsm__jukebox_8c.html#acb895e5f6705d5a1b4449f78245f130f">More...</a><br /></td></tr>
<tr class="separator:acb895e5f6705d5a1b4449f78245f130f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Jukebox FSM main file. </p>
<dl class="section author"><dt>Author</dt><dd>Sistemas Digitales II </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2023-10-01 </dd></dl>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="afa99ec4acc4ecb2dc3c2d05da15d0e3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa99ec4acc4ecb2dc3c2d05da15d0e3f">&#9670;&nbsp;</a></span>MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">a, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">b&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;((a) &gt; (b) ? (a) : (b))</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Macro to get the maximum of two values. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a01e7f7a7784027fc9217fd0d0f4f2423"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01e7f7a7784027fc9217fd0d0f4f2423">&#9670;&nbsp;</a></span>_execute_command()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _execute_command </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsm__jukebox__t.html">fsm_jukebox_t</a> *&#160;</td>
          <td class="paramname"><em>p_fsm_jukebox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>p_command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>p_param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Execute the command received by the USART. </p>
<p>This function is called by <code><a class="el" href="fsm__jukebox_8c.html#a9f8454ef1a723bf60fafd717751223c5" title="Read the command received by the USART.">do_read_command()</a></code> to execute the command received by the USART if it is valid.</p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b> âœ… 1. Implement the next flow graph. The colored blocks are the ones that depend on the buzzer FSM developed in Version 3. <br  />
</p><div class="image">
<img src="fsm_jukebox_execute_command.png" alt=""/>
</div>
<p> &#160;&#160;&#160;&#160;ðŸ’¡ <b>To print the message `&lsquo;Playing: &rsquo;' followed by the name of the melody to be played, you may use the function <code>sprintf()</code> to load the message in a local array</b> of chars and then print it by calling <code><a class="el" href="fsm__usart_8h.html#a714f188b6254d7f8ba8a1937d8d918b2" title="Set the data to send.">fsm_usart_set_out_data()</a></code>. This local array of chars must be big enough to store the message, and as much as <code>USART_OUTPUT_BUFFER_LENGTH</code>. </p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_fsm_jukebox</td><td>Pointer to the Jukebox FSM. </td></tr>
    <tr><td class="paramname">p_command</td><td>Pointer to the command to be executed. </td></tr>
    <tr><td class="paramname">p_param</td><td>Pointer to the parameter of the command to be executed. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa467014fd4156f5f687426203b75bc45"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa467014fd4156f5f687426203b75bc45">&#9670;&nbsp;</a></span>_parse_message()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool _parse_message </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>p_message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>p_command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>p_param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse the message received by the USART. </p>
<p>Given data received by the USART, this function parses the message and extracts the command and the parameter (if available).</p>
<blockquote class="doxtable">
<ol type="1">
<li>Split the message by space using function <code>strtok()</code> <br  />
</li>
<li>If there's a token (command), copy it to the <code>p_command</code> variable. Otherwise, return <code>false</code> <br  />
</li>
<li>Extract the parameter (if available). To do so, get the next token using function <code>strtok()</code>. If there's a token, copy it to the <code>p_param</code> variable. Otherwise, copy an empty string to the <code>p_param</code> variable <br  />
</li>
<li>Return <code>true</code> indicating that the message has been parsed correctly <br  />
</li>
</ol>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_message</td><td>Pointer to the message received by the USART. </td></tr>
    <tr><td class="paramname">p_command</td><td>Pointer to store the command extracted from the message. </td></tr>
    <tr><td class="paramname">p_param</td><td>Pointer to store the parameter extracted from the message. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the message has been parsed correctly </dd>
<dd>
false if the message has not been parsed correctly </dd></dl>

</div>
</div>
<a id="ac4ee155c8c44743e7b13f452e6647cd9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4ee155c8c44743e7b13f452e6647cd9">&#9670;&nbsp;</a></span>_set_next_song()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void _set_next_song </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsm__jukebox__t.html">fsm_jukebox_t</a> *&#160;</td>
          <td class="paramname"><em>p_fsm_jukebox</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the next song to be played. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Stop the buzzer by calling <code><a class="el" href="fsm__buzzer_8h.html#a4553c95f049f176b43a17e089d384877" title="Set the action to perform on the player.">fsm_buzzer_set_action()</a></code> with the right parameter <br  />
âœ… 2. Update the melody index to select to the next song by increasing this <code>melody_idx</code> in 1. If the result equals or greater than the maximum number of melodies (<code>MELODIES_MEMORY_SIZE</code>), set the index to 0. <br  />
&#160;&#160;&#160;&#160;ðŸ’¡ You can use the <code>%</code> (modulo) operator to get the remainder of the division <br  />
âœ… 3. Check if the melody exists. A melody exists if the length of the melody is greater than 0. If it does not exist, set the index of the melody to be played (<code>melody_idx</code>) to 0. After updating the <code>melody_idx</code> the name of the melody to be played (<code>p_melody</code>) to the name of the melody selected before. <br  />
âœ… 4. Print by the ITM terminal the message "Playing: %s\n" by calling <code>printf()</code> with the name of the melody to be played. This is only for debugging purposes and will be printed in the ITM terminal of the computer. <br  />
âœ… 5. Set the melody to be played by calling <code><a class="el" href="fsm__buzzer_8h.html#ab3e512b856b3f53e8deb6e48aa341e8f" title="Set the melody to play.">fsm_buzzer_set_melody()</a></code> properly <br  />
âœ… 6. Set the status of the buzzer correctly by calling <code><a class="el" href="fsm__buzzer_8h.html#a4553c95f049f176b43a17e089d384877" title="Set the action to perform on the player.">fsm_buzzer_set_action()</a></code>. After this call, the buzzer will start playing the melody <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_fsm_jukebox</td><td>Pointer to the Jukebox FSM. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a91c31f180f16c2d66ef56e62004c83bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91c31f180f16c2d66ef56e62004c83bc">&#9670;&nbsp;</a></span>check_activity()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_activity </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if any of the elements of the system is active. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Return <code>true</code> if any of the elements (button, USART, or buzzer) is active. Otherwise, return <code>false</code> <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a id="a05792c9a5a596679bd73a36882f307eb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05792c9a5a596679bd73a36882f307eb">&#9670;&nbsp;</a></span>check_command_received()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_command_received </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if the USART has received data. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Return the result of calling function <code><a class="el" href="fsm__usart_8h.html#a8b291fea03bda9ab260602d52479d730" title="Check if data has been received.">fsm_usart_check_data_received()</a></code> <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a id="ab86b278e34221a6d9698ecda96db6806"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab86b278e34221a6d9698ecda96db6806">&#9670;&nbsp;</a></span>check_melody_finished()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_melody_finished </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if the buzzer has finished playing the melody. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Return <code>true</code> if the result of calling function <code><a class="el" href="fsm__buzzer_8h.html#a154db75bb16bee2ad854f0ea02515f49" title="Get the action of the user.">fsm_buzzer_get_action()</a></code> is <code>STOP</code>. Otherwise, return <code>false</code> <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a id="ac620719196f7742a5e56bf2b96ca822e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac620719196f7742a5e56bf2b96ca822e">&#9670;&nbsp;</a></span>check_next_song_button()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_next_song_button </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if the button has been pressed for the required time to load the next song. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Call function <code><a class="el" href="fsm__button_8h.html#adf1e6388ab7f1216269fe912a11cf814" title="Return the duration of the last button press.">fsm_button_get_duration()</a></code> to get the duration of the button press <br  />
âœ… 2. Return <code>true</code> if the duration is greater than 0, and greater than the required time to load the next song, and lower than the required time to turn the Jukebox OFF. Otherwise, return <code>false</code> <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a id="a05439bd432881a570511d46a7d2ff699"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05439bd432881a570511d46a7d2ff699">&#9670;&nbsp;</a></span>check_no_activity()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_no_activity </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if all the is system active. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Call function <code><a class="el" href="fsm__jukebox_8c.html#a91c31f180f16c2d66ef56e62004c83bc" title="Check if any of the elements of the system is active.">check_activity()</a></code> and return the inverse of the result. The result will be <code>true</code> if all the elements of the system are inactive, otherwise it will be <code>false</code>. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct than contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a id="a941bb12de41897bba2b612cc87b3164b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a941bb12de41897bba2b612cc87b3164b">&#9670;&nbsp;</a></span>check_off()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_off </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if the button has been pressed for the required time to turn OFF the Jukebox. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. It is enough to call the function <code><a class="el" href="fsm__jukebox_8c.html#ab64512dbce31c38a36bff5e337f4fb8f" title="Check if the button has been pressed for the required time to turn ON the Jukebox.">check_on()</a></code> because the required time to turn ON and OFF the Jukebox is the same. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a id="ab64512dbce31c38a36bff5e337f4fb8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab64512dbce31c38a36bff5e337f4fb8f">&#9670;&nbsp;</a></span>check_on()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool check_on </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if the button has been pressed for the required time to turn ON the Jukebox. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Call function <code><a class="el" href="fsm__button_8h.html#adf1e6388ab7f1216269fe912a11cf814" title="Return the duration of the last button press.">fsm_button_get_duration()</a></code> to get the duration of the button press <br  />
âœ… 2. Return <code>true</code> if the duration is greater than 0 and greater than the required time to turn ON the Jukebox. Otherwise, return <code>false</code> <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true </dd>
<dd>
false </dd></dl>

</div>
</div>
<a id="a5c3617add85a9641d3109be58b5d7632"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c3617add85a9641d3109be58b5d7632">&#9670;&nbsp;</a></span>do_load_next_song()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void do_load_next_song </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Load the next song. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Call function <code><a class="el" href="fsm__jukebox_8c.html#ac4ee155c8c44743e7b13f452e6647cd9" title="Set the next song to be played.">_set_next_song()</a></code> to load the next song <br  />
âœ… 2. Reset the duration of the button by calling <code><a class="el" href="fsm__button_8h.html#ad72c67d37f009c4b627d12be1d00c25f" title="Reset the duration of the last button press.">fsm_button_reset_duration()</a></code> <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9f8454ef1a723bf60fafd717751223c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f8454ef1a723bf60fafd717751223c5">&#9670;&nbsp;</a></span>do_read_command()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void do_read_command </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read the command received by the USART. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Declare the following auxiliary variables, they will be used to parse the message received by the USART: <br  />
&#160;&#160;&#160;&#160;âœ… <code>p_message</code> of type <code>char</code> and size <code>USART_INPUT_BUFFER_LENGTH</code> <br  />
&#160;&#160;&#160;&#160;âœ… <code>p_command</code> of type <code>char</code> and size <code>USART_INPUT_BUFFER_LENGTH</code> <br  />
&#160;&#160;&#160;&#160;âœ… <code>p_param</code> of type <code>char</code> and size <code>USART_INPUT_BUFFER_LENGTH</code> <br  />
âœ… 2. Call function <code><a class="el" href="fsm__usart_8h.html#a598ef9863ebd0829e65ddaa94f9264ad" title="Get the data received.">fsm_usart_get_in_data()</a></code> to get the message received by the USART in the variable <code>p_message</code> <br  />
âœ… 3. Call function <code><a class="el" href="fsm__jukebox_8c.html#aa467014fd4156f5f687426203b75bc45" title="Parse the message received by the USART.">_parse_message()</a></code> to parse the message received by the USART and retrieve the result. Store the result in a boolean variable that indicates if the message is valid or not. This function will also parse the command and the parameter (if available) and store them in the variables <code>p_command</code> and <code>p_param</code> respectively <br  />
âœ… 4. If the message is valid, call function <code><a class="el" href="fsm__jukebox_8c.html#a01e7f7a7784027fc9217fd0d0f4f2423" title="Execute the command received by the USART.">_execute_command()</a></code> to execute the command received by the USART. <br  />
âœ… 5. Reset the message received by the USART by calling <code><a class="el" href="fsm__usart_8h.html#afa48c9865ec6f4f4e4cc9c6449e2a6a3" title="Reset the input data buffer.">fsm_usart_reset_input_data()</a></code> <br  />
âœ… 6. (Optional) Reset the <code>p_message</code> variable to 0 (or any other value) to avoid reading the same message again. This is not necessary, but it is useful for debugging purposes <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9d2922e21185739c528166e38ed8ab3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d2922e21185739c528166e38ed8ab3b">&#9670;&nbsp;</a></span>do_sleep_off()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void do_sleep_off </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Start the low power mode while the Jukebox is OFF. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Call function <code><a class="el" href="port__system_8h.html#ae3c6ff19d65f5cdeb1e1b556b0823b40" title="Enable low power consumption in sleep mode.">port_system_sleep()</a></code> to start the low power mode <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a70db2ffa8011371d02e1605a9976f6ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70db2ffa8011371d02e1605a9976f6ac">&#9670;&nbsp;</a></span>do_sleep_wait_command()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void do_sleep_wait_command </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Start the low power mode while the Jukebox is waiting for a command. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Call function <code><a class="el" href="port__system_8h.html#ae3c6ff19d65f5cdeb1e1b556b0823b40" title="Enable low power consumption in sleep mode.">port_system_sleep()</a></code> to start the low power mode <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a6a4825398f34ad61ae90c794df3fdaae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a4825398f34ad61ae90c794df3fdaae">&#9670;&nbsp;</a></span>do_sleep_while_off()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void do_sleep_while_off </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Start the low power mode while the Jukebox is OFF. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Call function <code><a class="el" href="port__system_8h.html#ae3c6ff19d65f5cdeb1e1b556b0823b40" title="Enable low power consumption in sleep mode.">port_system_sleep()</a></code> to start the low power mode <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aad10008c814d0625ee12467bc836d702"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad10008c814d0625ee12467bc836d702">&#9670;&nbsp;</a></span>do_sleep_while_on()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void do_sleep_while_on </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Start the low power mode while the Jukebox is ON. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Call function <code><a class="el" href="port__system_8h.html#ae3c6ff19d65f5cdeb1e1b556b0823b40" title="Enable low power consumption in sleep mode.">port_system_sleep()</a></code> to start the low power mode <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aba4043bc9382847ccce22462c81afab6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba4043bc9382847ccce22462c81afab6">&#9670;&nbsp;</a></span>do_start_jukebox()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void do_start_jukebox </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>After playing the intro melody, start the Jukebox. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Set the index of the melody to be played (<code>melody_idx</code>) to 0. You can also set the index to any other melody you want to play first. <br  />
âœ… 2. Set the name of the melody to be played (<code>p_melody</code>) to the name of the melody selected before. <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a2a0cabb2cea4aae7bf4da712caa5e539"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a0cabb2cea4aae7bf4da712caa5e539">&#9670;&nbsp;</a></span>do_start_up()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void do_start_up </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize the Jukebox by playing the intro melody, at the beginning of the program. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Reset the duration of the button by calling <code><a class="el" href="fsm__button_8h.html#ad72c67d37f009c4b627d12be1d00c25f" title="Reset the duration of the last button press.">fsm_button_reset_duration()</a></code> <br  />
âœ… 2. Enable RX USART interrupts by calling the right function from the <code>COMMON</code> (FSM) or <code>PORT</code> layers. <br  />
âœ… 3. Print by the ITM terminal the message "Jukebox ON\n" by calling <code>printf()</code>. This is only for debugging purposes and will be printed in the ITM terminal of the computer. <br  />
âœ… 4. Set the speed of the buzzer to 1.0 by calling <code><a class="el" href="fsm__buzzer_8h.html#ac6da02d907f191969f39f6988e07d8d9" title="Set the speed of the player.">fsm_buzzer_set_speed()</a></code> <br  />
âœ… 5. Set the <code>scale_melody</code> to be played by calling <code><a class="el" href="fsm__buzzer_8h.html#ab3e512b856b3f53e8deb6e48aa341e8f" title="Set the melody to play.">fsm_buzzer_set_melody()</a></code> properly <br  />
âœ… 6. Set the status of the buzzer to <code>PLAY</code> by calling <code><a class="el" href="fsm__buzzer_8h.html#a4553c95f049f176b43a17e089d384877" title="Set the action to perform on the player.">fsm_buzzer_set_action()</a></code>. With this the buzzer will start playing the melody <br  />
&#160;&#160;&#160;&#160;ðŸ’¡ Keep the call to the function <code><a class="el" href="fsm__button_8h.html#ad72c67d37f009c4b627d12be1d00c25f" title="Reset the duration of the last button press.">fsm_button_reset_duration()</a></code> <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7a6d305c45c351fca9a50a2b5d13d9a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a6d305c45c351fca9a50a2b5d13d9a6">&#9670;&nbsp;</a></span>do_stop_jukebox()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void do_stop_jukebox </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Turn the Jukebox OFF. </p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Reset the duration of the button by calling <code><a class="el" href="fsm__button_8h.html#ad72c67d37f009c4b627d12be1d00c25f" title="Reset the duration of the last button press.">fsm_button_reset_duration()</a></code> <br  />
âœ… 2. Disable USART interrupts by calling <code><a class="el" href="fsm__usart_8h.html#a3ff2f8934612ba0e45428e3c7b130716" title="Disable the USART RX interrupt.">fsm_usart_disable_rx_interrupt()</a></code> and <code><a class="el" href="fsm__usart_8h.html#a82161f8f68a7f603947322ed29fd9e11" title="Disable the USART TX interrupts.">fsm_usart_disable_tx_interrupt()</a></code>. You can call the functions from the port layer instead of the FSM layer. âœ… 3. Print by the ITM terminal the message "Jukebox OFF\n" by calling <code>printf()</code>. This is only for debugging purposes and will be printed in the ITM terminal of the computer. <br  />
âœ… 4. Stop the buzzer by calling <code><a class="el" href="fsm__buzzer_8h.html#a4553c95f049f176b43a17e089d384877" title="Set the action to perform on the player.">fsm_buzzer_set_action()</a></code> with the right parameter. With this the buzzer will stop playing the melody if it was playing <br  />
</p>
</blockquote>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_this</td><td>Pointer to an <code>fsm_t</code> struct that contains an <code><a class="el" href="structfsm__jukebox__t.html" title="Structure that contains the information of a melody.">fsm_jukebox_t</a></code>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a25d3f74400891769b83494e0202d5607"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25d3f74400891769b83494e0202d5607">&#9670;&nbsp;</a></span>fsm_jukebox_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void fsm_jukebox_init </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_this</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_fsm_button</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>on_off_press_time_ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_fsm_usart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_fsm_buzzer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>next_song_press_time_ms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a jukebox FSM. </p>
<p>This function initializes the default values of the FSM struct and calls to the <code>port</code> to initialize the HW of associated to the given ID.</p>
<blockquote class="doxtable">
<p><b>TO-DO alumnos:</b></p>
<p>âœ… 1. Call function <code>fsm_init()</code> with the received pointer to <code>fsm_t</code> and the transition table <br  />
âœ… 2. Initialize the fields <code>p_fsm_button</code>, <code>on_off_press_time_ms</code>, <code>p_fsm_usart</code>, <code>p_fsm_buzzer</code>, and <code>next_song_press_time_ms</code> of <code>p_fsm</code> with the received values <br  />
âœ… 3. Initialize the field that represents the melody index to <code>0</code> <br  />
âœ… 4. Reset the array of melodies to <code>0</code>. This will be used to know if a melody has been loaded or not <br  />
&#160;&#160;&#160;&#160;ðŸ’¡ Use the function <code>memset()</code> to reset the array of melodies <br  />
&#160;&#160;&#160;&#160;ðŸ’¡ Use <code>sizeof(p_fsm_jukebox-&gt;melodies)</code> to get the size of the array of melodies <br  />
âœ… 5. Load the melodies defined in <code><a class="el" href="melodies_8c.html" title="Melodies source file.">melodies.c</a></code> file to the array of melodies <br  />
&#160;&#160;&#160;&#160;ðŸ’¡ To do it you only need to store <b>each melody variable of type <code><a class="el" href="structmelody__t.html" title="Structure to define the Buzzer melody player FSM.">melody_t</a></code> that you want to include</b> in the array of melodies. e.g.: <code>p_fsm_jukebox-&gt;melodies[0] = scale_melody;</code> to store the <code>scale_melody</code> in the first position of the array of melodies <br  />
</p>
</blockquote>

</div>
</div>
<a id="ad983bf840c4087a815d989b1b927453b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad983bf840c4087a815d989b1b927453b">&#9670;&nbsp;</a></span>fsm_jukebox_new()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fsm_t* fsm_jukebox_new </td>
          <td>(</td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_fsm_button</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>on_off_press_time_ms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_fsm_usart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fsm_t *&#160;</td>
          <td class="paramname"><em>p_fsm_buzzer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>next_song_press_time_ms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new jukebox FSM. </p>
<p>This FSM implements a jukebox. The system plays melodies using a buzzer and a USART. The USART is used to send commands to the system. The commands are:</p>
<ul>
<li><code>play</code>: Play the current melody</li>
<li><code>pause</code>: Pause the current melody. It can be resumed with the <code>play</code> command</li>
<li><code>stop</code>: Stop the current melody. A <code>play</code> command afterwards will start the melody from the beginning</li>
<li><code>next</code>: Play the next melody</li>
<li><code>speed</code>: Change the speed of the current melody. It requires a parameter that indicates the new speed higher than 0.1</li>
<li><code>select</code>: Select a melody. It requires a parameter that indicates the melody number to select</li>
<li><code>info</code>: Send information about the current melody</li>
</ul>
<p>The melodies are stored in the <code><a class="el" href="melodies_8c.html" title="Melodies source file.">melodies.c</a></code> file and they are defined as arrays of notes.</p>
<p>The jukebox plays an initial melody when the system starts. To turn the system ON or OFF a long button pressed is needed.</p>
<p>A short button press changes and reproduces the next melody. If it has been reached the last melody, the system will reproduce the first melody again.</p>
<p>When the system is OFF it does not respond to any command.</p>
<p>To better understand the system, please watch the following video:</p>
<p> 
<iframe width="854" height="480" src="https://www.youtube.com/embed/cUdxMichHwM" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</p>
<p>This is the HW diagram of the system:</p>
<div class="image">
<img src="jukebox_fritzing.png" alt=""/>
</div>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_fsm_button</td><td>Pointer to the button FSM </td></tr>
    <tr><td class="paramname">on_off_press_time_ms</td><td>Button press time in milliseconds to turn the system ON or OFF </td></tr>
    <tr><td class="paramname">p_fsm_usart</td><td>Pointer to the USART FSM </td></tr>
    <tr><td class="paramname">p_fsm_buzzer</td><td>Pointer to the buzzer FSM. </td></tr>
    <tr><td class="paramname">next_song_press_time_ms</td><td>Button press time in milliseconds to change to the next song.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to the button FSM </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="acb895e5f6705d5a1b4449f78245f130f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb895e5f6705d5a1b4449f78245f130f">&#9670;&nbsp;</a></span>fsm_trans_jukebox</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fsm_trans_t fsm_trans_jukebox[]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Array representing the transitions table of the FSM Jukebox. </p>
<div class="image">
<img src="fsm_jukebox.png" alt=""/>
</div>
 
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_bdd9a5d540de89e9fe90efdfc6973a4f.html">common</a></li><li class="navelem"><a class="el" href="dir_4e4d22e38ca4e2e8207825ee2d00bc54.html">src</a></li><li class="navelem"><a class="el" href="fsm__jukebox_8c.html">fsm_jukebox.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
